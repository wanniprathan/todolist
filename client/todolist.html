<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8" />
    <title>Todo list</title>    
    <script src="superfetch.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- HEADER -->
    <!--header id="main-header"-->
      <!--div class="container"-->
    <select id="selLists"></select>
        <input id="title" type="text" placeholder="Liste navn">
         <button id="btnCreate">Lag liste</button>
          <br><br>
         <button id="btnDelete">Slette Liste</button>
          <br><br>
        <input id="content" type="text" placeholder="Hva skal du huske på?">
        <input id="dato" type="date">
        <button id="btnlistELement">Legg til mere på listen</button>
        
       
    
    
    <div id="items"></div>
         
      <!--/div-->  
    <!--/header-->
    
    
</body>

<script>
    
    var title = document.getElementById("title");
    var btnCreate = document.getElementById("btnCreate");
    var btnDelete = document.getElementById("btnDelete");
    
    var content = document.getElementById("content");
    var dato = document.getElementById("dato");
    var btnlistELement = document.getElementById("btnlistELement");
    
    var selLists = document.getElementById("selLists");
    var items = document.getElementById("items");
    //var d = new Date(year, month, day);
    
    fillSelect();
    fillItemlist();
   
    //funksjonen her lagrer/lager nye verdier i select--------------
    
    function fillSelect() {
        
        var url = "http://localhost:3001/list/";
             

        superfetch(url, "json", function(data){
            
            selLists.innerHTML = "";
            
           for (var i = 0; i < data.length; i++){
               
               var op = document.createElement("option");
               op.innerHTML=data[i].list_name;
               op.value = data[i].id;
               selLists.appendChild(op);
               
               //få tak i listeideen fra select med: selLists.value
               
           }
            
        }, function(err){
            
            console.log(err);
            
        });
        
    }
    
    
      
    //Knappen her lager liste-----------
    btnCreate.onclick = function() {
        
         var upload = JSON.stringify({            
            title: title.value
                    
        });
        
        var token = JSON.parse(localStorage.getItem("logindata")).token;  
        var url = "http://localhost:3001/list/";
        

        var cfg = {
            method: "POST",            
            body: upload
            
        }      

        superfetch(url, "json", succ, error, cfg);
    }
   
    
    //success --------------------------------------
    function succ(data) {
       fillItemlist();
       fillSelect();
    }
    
    //error ----------------------------------------
    function error(err) {
        console.log(err);
    }
    
    
      
     //Knappen her legger til mere på listen-----------
    btnlistELement.onclick = function() {
        
         var upload = JSON.stringify({            
            title: title.value,
            content: content.value,
             dato: dato.value,
             listId: selLists.value
                    
        });
        
        var token = JSON.parse(localStorage.getItem("logindata")).token;  
        var url = "http://localhost:3001/listItems/";
        

        var cfg = {
            method: "POST",            
            body: upload
            
        }      

        superfetch(url, "json", succ, error, cfg);
    }
    
    
  
    
    
    //Funksjonen fillItemList henter ut alt på get listItems
    
    
    function fillItemlist() {
        
         var url = "http://localhost:3001/listItems/";
           

        superfetch(url, "json", function(data){
            
            console.log(data);
            
            items.innerHTML = "";
            
           for (var i = 0; i < data.length; i++){
               
               var dato = new Date(data[i].dato).toDateString();
               
               items.innerHTML += "<h3> " + data[i].title + "</h3>";
               items.innerHTML += "<h3> " + data[i].data + "</h3>";
               items.innerHTML += "<h3> Dato: " + dato + "</h3>";
               items.innerHTML += "<hr>";
              
               
               
           }
            
        }, function(err){
            
            console.log(err);
            
        });
        
    }
    
    
    //Funksjon delete, sletter lister
    btnDelete.onclick = function() {
        
        var upload = JSON.stringify({            
            title: title.value,
            content: content.value,
             dato: dato.value,
             listId: selLists.value
                    
        });
        
        var token = JSON.parse(localStorage.getItem("logindata")).token;  
        var url = "http://localhost:3001/list/?listeid=" + selLists.value;
        

        var cfg = {
            method: "DELETE"
            
        }      

        superfetch(url, "json", function(data){
            
            console.log(data);
            fillSelect();
            fillItemlist();
            
        }, function(err){
            
            console.log(err);
            
        }, cfg);
        
        
        
        
        
    }
    
    
    //error ----------------------------------------
    function error(err) {
        console.log(err);
    }
    
    

</script>

</html>